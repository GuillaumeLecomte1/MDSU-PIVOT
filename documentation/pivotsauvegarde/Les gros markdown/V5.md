# Dossier Technique - Projet PIVOT Marketplace (Proof of Concept)

## Table des matières

- [Introduction et Contexte](#introduction-et-contexte)
- [Modélisation](#modélisation)
  - [Modèle Conceptuel de Données (MCD)](#modèle-conceptuel-de-données-mcd)
- [Architecture et Choix Technologiques](#architecture-et-choix-technologiques)
  - [Vue d'ensemble de l'Architecture](#vue-densemble-de-larchitecture)
  - [Stack Technologique et Justification des Choix](#stack-technologique-et-justification-des-choix)
  - [Couches Applicatives](#couches-applicatives)
  - [Architecture du Code](#architecture-du-code)
- [Fonctionnalités Développées](#fonctionnalités-développées)
  - [Description des Fonctionnalités](#description-des-fonctionnalités)
- [Spécifications Techniques](#spécifications-techniques)
  - [API et Interfaces](#api-et-interfaces)
  - [Solutions Techniques Déployées](#solutions-techniques-déployées)
  - [Gestion des Données](#gestion-des-données)
- [Sécurisation](#sécurisation)
  - [Authentification et Autorisation](#authentification-et-autorisation)
  - [Protection des données](#protection-des-données)
  - [Mesures de Sécurité Supplémentaires](#mesures-de-sécurité-supplémentaires)
- [Méthodes de Testing](#méthodes-de-testing)
  - [Approche de Test](#approche-de-test)
  - [Tests Unitaires](#tests-unitaires)
  - [Tests Fonctionnels](#tests-fonctionnels)
- [PV de Recette](#pv-de-recette)
  - [Scénarios de Test](#scénarios-de-test)
  - [Résultats des Tests](#résultats-des-tests)
  - [Validation](#validation)
- [Prototype](#prototype)
- [Conclusion](#conclusion)

## Introduction et Contexte

Dans un contexte économique où les plateformes de commerce en ligne connaissent une croissance exponentielle, notre projet Pivot vise à offrir une solution innovante pour les ressourceries. Ces structures, dédiées à la récupération, la valorisation et la revente de biens sur un territoire donné, jouent un rôle crucial dans la sensibilisation et l'éducation à l'environnement, contribuant ainsi à l'économie circulaire et à la réduction des déchets.

PIVOT est conçu comme une plateforme dédiée aux ressourceries en France, permettant de donner une seconde vie aux produits tout en créant de nouvelles interactions sociales. Ce proof of concept s'articule autour d'une architecture simple mais efficace, permettant aux ressourceries de mettre en ligne leurs produits.

### Origine et Objectifs du Projet

Le projet Pivot est né d'une observation simple : malgré la démocratisation du commerce en ligne, les ressourceries, acteurs essentiels de l'économie circulaire, ne disposent pas d'outils numériques adaptés à leurs besoins spécifiques. Notre solution vise à combler ce fossé en proposant une plateforme accessible, spécifiquement conçue pour ce secteur.

Les ressourceries font face à plusieurs défis spécifiques :
- Gestion d'inventaires variés et uniques (objets de seconde main)
- Valorisation de l'aspect écologique et social des produits
- Nécessité de toucher un public plus large que leur zone géographique immédiate
- Besoin de solutions numériques adaptées à leurs ressources souvent limitées

### Public Cible

Le projet s'adresse à deux cibles distinctes mais complémentaires :

- **Les ressourceries (B2B)**, qui cherchent à étendre leur portée et à digitaliser leur offre sans investissement technique lourd.
- **Les consommateurs éco-responsables (B2C)**, qui souhaitent acheter des produits de seconde main tout en soutenant des structures locales à vocation sociale et environnementale.

### Périmètre Fonctionnel

Le proof of concept se concentre sur les fonctionnalités essentielles d'une marketplace adaptée aux ressourceries, avec une attention particulière portée à :

- **La gestion des produits de seconde main**, avec des caractéristiques spécifiques comme l'état, les dimensions, la provenance.

### Attentes et Besoins Identifiés

Lors de l'analyse des besoins, plusieurs attentes clés ont été identifiées :

- **Une interface d'administration intuitive**, permettant une gestion simplifiée des produits uniques.
- **Des outils de valorisation de l'impact environnemental**, mettant en avant la contribution à l'économie circulaire.
- **Une architecture évolutive**, capable de s'adapter à la croissance future de la plateforme.

En tant que développeur web du projet, mon rôle est de concevoir et de réaliser ce proof of concept. Cela inclut le développement du backend, la création d'une interface utilisateur fonctionnelle, et la mise en place des fonctionnalités techniques clés.

## Modélisation

### Modèle Conceptuel de Données (MCD)

#### Introduction

La modélisation des données est une étape fondamentale dans la conception de notre plateforme Pivot pour ressourceries. Elle permet de structurer les informations et d'assurer une gestion efficace des interactions entre les différents acteurs (administrateurs, ressourceries, clients).

Le Modèle Conceptuel de Données (MCD) que nous avons élaboré repose sur plusieurs entités interconnectées, garantissant ainsi une organisation cohérente des informations et une évolutivité adaptée aux besoins spécifiques des ressourceries.

Le MCD repose sur huit entités principales : **Users**, **Roles**, **Products**, **Categories**, **Orders**, **OrderItems**, **Ressourceries**, et **Payments**.

Ces entités définissent la structure de la base de données et permettent d'assurer le bon fonctionnement de la marketplace en respectant les contraintes métiers propres au secteur des ressourceries.

#### Description des Entités

##### 1. Utilisateurs (Users)

L'entité **Users** regroupe les informations des différents profils de l'application :

- **Administrateurs** : gestionnaires de la plateforme avec des droits étendus.
- **Ressourceries** : structures de réemploi proposant leurs produits sur la marketplace.
- **Clients** : utilisateurs effectuant des achats sur la plateforme.

Les principaux attributs de cette entité incluent :
- Les informations générales : name, email, password, phone, address.
- Des données spécifiques : role, company_name, ape_code (pour les ressourceries).
- Des données de gestion : created_at, updated_at, email_verified_at.

##### 2. Rôles (Roles)

L'entité **Roles** définit les différents niveaux d'accès et de permissions au sein de la plateforme :

- Un identifiant unique id.
- Un nom de rôle name (admin, ressourcerie, client).
- Une description description du rôle.

Cette entité permet une gestion des autorisations et des accès aux fonctionnalités de la plateforme, adaptée aux besoins spécifiques de chaque type d'utilisateur.

##### 3. Produits (Products)

L'entité **Products** représente les articles de seconde main disponibles à la vente sur la marketplace :

- Un identifiant unique id.
- Des informations descriptives : name, description, price, condition, dimensions, color, brand.
- Des références vers la ressourcerie ressourcerie_id et la catégorie category_id.
- Des métadonnées : created_at, updated_at, stock, is_available.

Cette structure permet une gestion du catalogue produits, avec des informations détaillées pour chaque article, particulièrement importantes pour des objets de seconde main dont l'état et les caractéristiques peuvent varier.

##### 4. Catégories (Categories)

L'entité **Categories** permet d'organiser les produits par thématiques :

- Un identifiant unique id.
- Un nom name et une description description.
- Une référence parent_id pour les sous-catégories.
- Des métadonnées : created_at, updated_at.

Cette hiérarchisation facilite la navigation et la recherche de produits pour les clients, permettant de regrouper les objets par type (mobilier, électroménager, vêtements, etc.).

##### 5. Commandes (Orders)

L'entité **Orders** gère les transactions effectuées sur la plateforme :

- Un identifiant unique id.
- Une référence vers le client user_id.
- Des informations de livraison ou de retrait : shipping_address, shipping_method.
- Des données financières : total_amount, status.
- Des métadonnées : created_at, updated_at, completed_at.

##### 6. Éléments de commande (OrderItems)

L'entité **OrderItems** détaille les produits inclus dans chaque commande :

- Un identifiant unique id.
- Des références vers la commande order_id et le produit product_id.
- Des informations quantitatives : quantity, unit_price.
- Des métadonnées : created_at, updated_at.

##### 7. Ressourceries (Ressourceries)

L'entité **Ressourceries** représente les structures de réemploi présentes sur la plateforme :

- Un identifiant unique id.
- Une référence vers l'utilisateur user_id.
- Des informations descriptives : name, description, logo_url.
- Des données de contact : email, phone, address, city, postal_code.
- Des données légales : siret.
- Des métadonnées : created_at, updated_at, is_active.

##### 8. Paiements (Payments)

L'entité **Payments** gère les transactions financières :

- Un identifiant unique id.
- Une référence vers la commande order_id.
- Des informations de paiement : amount, payment_method, transaction_id.
- Un statut status (pending, completed, failed).
- Des métadonnées : created_at, updated_at.

## Architecture et Choix Technologiques

### Vue d'ensemble de l'Architecture

L'architecture technique de Pivot pour ressourceries repose sur une structure simple mais efficace, spécifiquement conçue pour ce proof of concept. Notre choix s'est porté sur une architecture MVC (Modèle-Vue-Contrôleur) basée sur Laravel, complétée par une interface utilisateur construite avec Inertia.js et React.

Cette architecture permet de combiner la robustesse d'un backend PHP avec une interface utilisateur fonctionnelle, tout en maintenant une complexité technique adaptée au contexte des ressourceries qui n'ont généralement pas d'équipes techniques dédiées.

Le schéma ci-dessous illustre les principales composantes de l'architecture et leurs interactions :

```
┌─────────────────────────────────────────────────────────────────┐
│                        Client (Navigateur)                       │
└───────────────────────────────┬─────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                           Laravel (PHP)                          │
│                                                                 │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────────────┐  │
│  │   Routes    │───▶│ Controllers │───▶│      Services       │  │
│  └─────────────┘    └──────┬──────┘    └──────────┬──────────┘  │
│                            │                       │             │
│                            ▼                       ▼             │
│                    ┌─────────────┐        ┌─────────────────┐   │
│                    │   Inertia   │        │  Repositories   │   │
│                    └──────┬──────┘        └──────────┬──────┘   │
│                            │                         │           │
│                            ▼                         ▼           │
│                    ┌─────────────┐            ┌─────────────┐   │
│                    │    React    │            │   Models    │   │
│                    └─────────────┘            └──────┬──────┘   │
│                                                      │           │
│                                                      ▼           │
│                                               ┌─────────────┐   │
│                                               │  Database   │   │
│                                               └─────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                        Services Externes                         │
│  ┌─────────────┐                                                │
│  │    Stripe   │                                                │
│  └─────────────┘                                                │
└─────────────────────────────────────────────────────────────────┘
```

### Stack Technologique et Justification des Choix

#### Backend

- **Laravel 10** : Framework PHP robuste et mature, offrant une base solide pour le développement d'applications web. Laravel a été choisi pour sa documentation exhaustive, sa communauté active et ses fonctionnalités intégrées qui accélèrent le développement (ORM Eloquent, système d'authentification, validation des données, etc.).

- **MySQL 8** : Système de gestion de base de données relationnelle performant et fiable, parfaitement adapté pour stocker les données structurées de la marketplace (utilisateurs, produits, commandes, etc.). MySQL a été sélectionné pour sa fiabilité et sa compatibilité avec Laravel.

- **PHP 8.1** : Version récente du langage PHP, offrant des performances améliorées et des fonctionnalités modernes.

#### Frontend

- **Inertia.js** : Bibliothèque permettant de créer des applications monopages (SPA) sans avoir à construire une API. Inertia.js sert de pont entre Laravel et React, offrant une expérience de développement fluide et une navigation côté client sans rechargement de page.

- **React 18** : Bibliothèque JavaScript pour la construction d'interfaces utilisateur interactives. React a été choisi pour sa flexibilité et ses performances.

- **Tailwind CSS 3** : Framework CSS utilitaire permettant de construire rapidement des interfaces personnalisées sans quitter le HTML.

#### Outils et Services

- **Stripe** : Service de paiement en ligne sécurisé, permettant de gérer les transactions financières entre les clients et les ressourceries.

- **Laravel Sanctum** : Solution d'authentification légère pour les SPA, API et applications mobiles. Sanctum gère l'authentification des utilisateurs et la sécurisation des routes.

- **Laravel Breeze** : Package d'authentification minimaliste, fournissant une implémentation simple de toutes les fonctionnalités d'authentification de Laravel.

### Couches Applicatives

#### 1. Couche Présentation

La couche présentation est responsable de l'interface utilisateur et de l'expérience utilisateur. Elle est construite avec React, Inertia.js et Tailwind CSS.

Cette couche gère :
- L'affichage des données aux utilisateurs
- La capture des entrées utilisateur
- La validation côté client
- L'adaptation responsive pour différents appareils

#### 2. Couche Application

La couche application contient la logique métier de l'application et coordonne les interactions entre la couche présentation et la couche domaine. Elle comprend :

- **Controllers** : Gèrent les requêtes HTTP, valident les entrées et coordonnent les réponses.
- **Services** : Encapsulent la logique métier et orchestrent les opérations entre différentes entités.
- **Middleware** : Filtrent et transforment les requêtes HTTP (authentification, autorisation, etc.).
- **Validators** : Assurent la validation des données entrantes selon des règles métier.

#### 3. Couche Domaine

La couche domaine contient les entités métier et les règles de gestion spécifiques aux ressourceries. Elle comprend :

- **Models** : Représentent les entités métier (Ressourcerie, Product, Order, etc.) avec leurs attributs et relations.
- **Repositories** : Abstraient l'accès aux données et encapsulent la logique de requête.

#### 4. Couche Infrastructure

La couche infrastructure fournit les services techniques nécessaires au fonctionnement de l'application :

- **Database** : Gestion de la persistance des données avec MySQL.
- **Storage** : Gestion des fichiers (images des produits, logos des ressourceries).
- **External Services** : Intégration avec des services tiers (Stripe).

### Architecture du Code

L'architecture du code du projet PIVOT Marketplace suit les conventions et bonnes pratiques de Laravel, avec une organisation claire des fichiers et des responsabilités bien définies.

#### Structure des Répertoires

La structure des répertoires suit l'organisation standard de Laravel, avec quelques adaptations spécifiques au projet :

```
marketplace/
├── app/                      # Cœur de l'application
│   ├── Console/              # Commandes artisan personnalisées
│   ├── Exceptions/           # Gestionnaires d'exceptions
│   ├── Http/                 # Contrôleurs, Middleware, Requests
│   │   ├── Controllers/      # Contrôleurs de l'application
│   │   ├── Middleware/       # Middleware pour filtrer les requêtes HTTP
│   │   └── Requests/         # Classes de validation des requêtes
│   ├── Models/               # Modèles Eloquent
│   ├── Providers/            # Fournisseurs de services
│   └── Services/             # Services métier
├── bootstrap/                # Fichiers de démarrage
├── config/                   # Configuration de l'application
├── database/                 # Migrations et seeders
│   ├── factories/            # Factories pour les tests
│   ├── migrations/           # Migrations de base de données
│   └── seeders/              # Seeders pour peupler la base de données
├── public/                   # Point d'entrée public et assets compilés
├── resources/                # Ressources non compilées
│   ├── css/                  # Fichiers CSS
│   ├── js/                   # Fichiers JavaScript et composants React
│   │   ├── Components/       # Composants React réutilisables
│   │   ├── Layouts/          # Layouts pour Inertia.js
│   │   └── Pages/            # Pages React pour Inertia.js
│   └── views/                # Vues Blade (utilisées principalement pour les emails)
├── routes/                   # Définition des routes
│   ├── api.php               # Routes API
│   ├── channels.php          # Canaux de diffusion
│   └── web.php               # Routes web
├── storage/                  # Fichiers générés par l'application
├── tests/                    # Tests automatisés
└── vendor/                   # Dépendances (via Composer)
```

#### Organisation du Code

Le code est organisé selon les principes suivants :

1. **Séparation des responsabilités** : Chaque classe a une responsabilité unique et bien définie.
2. **Injection de dépendances** : Utilisation de l'injection de dépendances pour favoriser le découplage.
3. **Modèles riches** : Les modèles Eloquent encapsulent la logique liée aux données.
4. **Contrôleurs légers** : Les contrôleurs délèguent le traitement aux services et aux modèles.
5. **Validation des données** : Utilisation des Form Requests pour valider les entrées utilisateur.

#### Conventions de Nommage

Le projet suit les conventions de nommage de Laravel :

- **Contrôleurs** : Noms au singulier, suffixe "Controller" (ex: `ProductController`)
- **Modèles** : Noms au singulier (ex: `Product`)
- **Migrations** : Format date_action_table (ex: `2023_01_15_create_products_table`)
- **Tables** : Noms au pluriel (ex: `products`)

#### Flux de Données

Le flux de données typique dans l'application suit ce parcours :

1. La requête HTTP est reçue et traitée par le routeur.
2. Le middleware approprié filtre et transforme la requête.
3. Le contrôleur reçoit la requête et coordonne la réponse.
4. Les services métier effectuent les opérations nécessaires.
5. Les modèles interagissent avec la base de données.
6. Le contrôleur prépare les données pour la vue.
7. Inertia.js transmet les données aux composants React.
8. React rend l'interface utilisateur.

## Fonctionnalités Développées

### Description des Fonctionnalités

Le proof of concept de Pivot comprend plusieurs fonctionnalités essentielles visant à démontrer la viabilité de la plateforme pour les ressourceries.

Les fonctionnalités sont divisées en 3 types d'accès :

- Administrateur
- Vendeur (Ressourcerie)
- Client

#### Page d'accueil

La landing page présente une interface simple et fonctionnelle, avec une navigation vers les autres sections. La page d'accueil est conçue pour être responsive et accessible.

**Scénarios possibles :**

- **Utilisateur non connecté** : Accès à l'information générale, boutons d'inscription et de connexion, présentation des catégories et des produits.
- **Utilisateur connecté** : Accès à son profil et à ses services en fonction de son rôle.

#### Inscription et Connexion

Les utilisateurs peuvent s'inscrire en fournissant leurs informations de base. Lors de la création d'un compte, ils choisissent le type d'utilisateur qu'ils souhaitent être : **Client** ou **Ressourcerie**.

Le processus d'inscription utilise l'authentification par **Laravel Sanctum** pour garantir la confidentialité des données.

**Scénarios possibles :**

- **Nouvel utilisateur** :
  1. Remplissage du formulaire d'inscription avec des informations de base (nom, adresse e-mail, mot de passe).
  2. Sélection du type d'utilisateur : **Client** ou **Ressourcerie**.
  3. Validation des données avec vérification des champs obligatoires.
  4. Enregistrement des informations dans la base de données.
  5. Redirection vers l'interface correspondant au type d'utilisateur choisi.
- **Utilisateur existant** :
  - Connexion via un formulaire en saisissant son e-mail et son mot de passe.
  - Gestion des erreurs telles que les identifiants incorrects.
  - Authentification par Laravel Sanctum pour une session sécurisée.

#### Gestion du Compte

L'utilisateur peut gérer ses informations personnelles via un espace dédié, avec des champs spécifiques en fonction de son type d'utilisateur (Client ou Ressourcerie).

**Fonctionnalités clés :**

- **Modification des données personnelles :**
  - **Pour les Clients :** Possibilité de mettre à jour des informations de base telles que le nom, l'adresse e-mail, le mot de passe.
  - **Pour les Ressourceries :** En plus des informations de base, les ressourceries peuvent renseigner des détails professionnels essentiels :
    - **Informations de la boutique :** Nom, description, logo.
    - **Coordonnées professionnelles :** Adresse, téléphone, email de contact.
- **Sécurité des données :** Protection des informations grâce à des mécanismes d'authentification sécurisés.

#### Utilisateur de type Client

##### Parcours d'Achat

Le parcours d'achat permet de naviguer dans le catalogue, de sélectionner des produits et de finaliser une commande.

**Fonctionnalités clés :**

- **Navigation dans le catalogue :** Recherche par mots-clés, filtrage par catégories, prix, ressourceries, etc.
- **Fiche produit détaillée :** Informations complètes, photos, disponibilité.
- **Panier d'achat :** Ajout/suppression de produits, modification des quantités, calcul automatique du total.
- **Processus de commande :** Saisie des informations de livraison, choix du mode de paiement, récapitulatif avant validation.
- **Paiement sécurisé :** Intégration avec Stripe pour des transactions sécurisées.

##### Suivi des Commandes

Les clients peuvent suivre l'état de leurs commandes et accéder à l'historique de leurs achats.

**Fonctionnalités clés :**

- **Tableau de bord des commandes :** Vue d'ensemble des commandes en cours et passées.
- **Détail des commandes :** Informations sur chaque commande (produits, prix, statut, etc.).

#### Utilisateur de type Ressourcerie

##### Gestion de la Boutique

Les ressourceries peuvent créer leur espace de vente sur la marketplace.

**Fonctionnalités clés :**

- **Création de boutique :** Configuration initiale avec nom, description, logo, etc.
- **Statistiques :** Suivi des performances (vues, ventes).

##### Gestion des Produits

Les ressourceries peuvent gérer leur catalogue de produits de manière autonome.

**Fonctionnalités clés :**

- **Ajout de produits :** Création de fiches produits avec informations détaillées, photos, prix, etc.
- **Modification/suppression :** Mise à jour ou retrait de produits du catalogue.
- **Gestion des stocks :** Suivi des quantités disponibles.

##### Gestion des Commandes

Les ressourceries peuvent suivre et traiter les commandes concernant leurs produits.

**Fonctionnalités clés :**

- **Tableau de bord des commandes :** Vue d'ensemble des commandes à traiter.
- **Traitement des commandes :** Changement de statut, préparation.

##### Gestion des Paiements

Les ressourceries peuvent suivre leurs revenus.

**Fonctionnalités clés :**

- **Tableau de bord financier :** Vue d'ensemble des ventes, revenus.
- **Historique des transactions :** Détail des paiements reçus.

#### Utilisateur de type Administrateur

##### Gestion de la Plateforme

Les administrateurs disposent d'un tableau de bord pour gérer la marketplace.

**Fonctionnalités clés :**

- **Vue d'ensemble :** Statistiques globales, activité récente.
- **Gestion des utilisateurs :** Création, modification, suspension de comptes.
- **Gestion des catégories :** Structuration du catalogue avec catégories.
- **Paramètres système** : Configuration des paramètres globaux de la plateforme.

##### Gestion des Transactions

Les administrateurs peuvent superviser les transactions financières de la plateforme.

**Fonctionnalités clés :**

- **Suivi des commandes :** Vue globale de toutes les commandes en cours.
- **Gestion des paiements :** Supervision des transactions.

## Spécifications Techniques

### API et Interfaces

#### API Internes

Le projet PIVOT Marketplace utilise principalement Inertia.js pour la communication entre le backend Laravel et le frontend React, ce qui élimine le besoin d'une API REST traditionnelle. Cependant, plusieurs endpoints sont définis pour gérer les interactions spécifiques.

##### Endpoints Principaux

1. **Authentification**
   - `POST /login` : Authentification utilisateur
   - `POST /register` : Création de compte
   - `POST /logout` : Déconnexion
   - `POST /forgot-password` : Demande de réinitialisation de mot de passe
   - `POST /reset-password` : Réinitialisation de mot de passe

2. **Utilisateurs**
   - `GET /user/profile` : Récupération du profil utilisateur
   - `PUT /user/profile` : Mise à jour du profil
   - `GET /user/orders` : Liste des commandes de l'utilisateur

3. **Ressourceries**
   - `GET /ressourceries` : Liste des ressourceries
   - `GET /ressourceries/{id}` : Détails d'une ressourcerie
   - `POST /ressourceries` : Création d'une ressourcerie (admin/ressourcerie)
   - `PUT /ressourceries/{id}` : Mise à jour d'une ressourcerie (admin/ressourcerie)

4. **Produits**
   - `GET /products` : Liste des produits avec filtres
   - `GET /products/{id}` : Détails d'un produit
   - `GET /products/search` : Recherche de produits
   - `POST /products` : Ajout d'un produit (ressourcerie)
   - `PUT /products/{id}` : Mise à jour d'un produit (ressourcerie)
   - `DELETE /products/{id}` : Suppression d'un produit (ressourcerie)

5. **Catégories**
   - `GET /categories` : Liste des catégories
   - `GET /categories/{id}/products` : Produits d'une catégorie

6. **Panier et Commandes**
   - `GET /cart` : Contenu du panier
   - `POST /cart/add` : Ajout au panier
   - `PUT /cart/update` : Mise à jour du panier
   - `DELETE /cart/remove` : Suppression d'un élément du panier
   - `POST /orders` : Création d'une commande
   - `GET /orders/{id}` : Détails d'une commande
   - `PUT /orders/{id}/status` : Mise à jour du statut (ressourcerie/admin)

7. **Paiements**
   - `POST /payments/intent` : Création d'une intention de paiement
   - `POST /payments/confirm` : Confirmation d'un paiement
   - `GET /payments/{id}` : Détails d'un paiement

#### Intégrations Externes

##### Stripe (Paiements)

L'intégration avec Stripe permet de gérer les paiements en ligne de manière sécurisée :

- **Création d'intention de paiement** : Génération d'une intention de paiement côté serveur
- **Confirmation de paiement** : Traitement de la confirmation après paiement réussi
- **Webhooks** : Gestion des événements Stripe (paiement réussi, échec, remboursement)

### Solutions Techniques Déployées

#### Gestion de l'Authentification

La gestion de l'authentification est implémentée à l'aide de Laravel Sanctum, qui offre un système d'authentification léger et sécurisé pour les SPA (Single Page Applications). Les principales fonctionnalités incluent :

- **Authentification par cookie** : Utilisation de cookies HTTP-only pour les sessions
- **Protection CSRF** : Génération et validation automatiques des tokens CSRF
- **Gestion des sessions** : Configuration des durées de session et des politiques d'expiration

#### Gestion du Panier d'Achat

Le panier d'achat est implémenté avec une combinaison de stockage côté serveur et côté client :

- **Session côté serveur** : Stockage des éléments du panier dans la session pour les utilisateurs non connectés
- **Base de données** : Persistance du panier pour les utilisateurs connectés
- **Synchronisation** : Fusion automatique du panier de session avec le panier en base de données lors de la connexion

#### Système de Paiement

L'intégration avec Stripe est réalisée via la bibliothèque officielle Stripe PHP et le package Cashier de Laravel :

- **Intégration côté serveur** : Création et gestion des intentions de paiement
- **Intégration côté client** : Utilisation de Stripe Elements pour les formulaires de paiement
- **Webhooks** : Configuration des webhooks pour le traitement asynchrone des événements de paiement

#### Gestion des Images

La gestion des images de produits est implémentée avec le système de stockage de Laravel :

- **Upload sécurisé** : Validation et sanitisation des fichiers téléchargés
- **Redimensionnement** : Génération automatique de différentes tailles d'images
- **Stockage optimisé** : Configuration du stockage pour les performances et la sécurité

### Gestion des Données

#### Migrations et Structure de la Base de Données

La structure de la base de données est définie à l'aide du système de migrations de Laravel, qui permet de versionner et de déployer facilement les changements de schéma. Les principales tables incluent :

- **users** : Stockage des informations utilisateur
- **roles** : Définition des rôles et permissions
- **products** : Catalogue des produits disponibles
- **categories** : Hiérarchie des catégories de produits
- **orders** : Commandes passées par les clients
- **order_items** : Éléments individuels des commandes
- **ressourceries** : Informations sur les ressourceries
- **payments** : Transactions financières

#### Requêtes et Performance

L'optimisation des requêtes est réalisée à l'aide des fonctionnalités d'Eloquent :

- **Eager Loading** : Chargement anticipé des relations pour éviter le problème N+1
- **Indexation** : Création d'index sur les colonnes fréquemment utilisées dans les requêtes
- **Pagination** : Limitation du nombre de résultats par page pour les listes volumineuses

#### Validation des Données

La validation des données est assurée par le système de validation de Laravel :

- **Form Requests** : Classes dédiées à la validation des requêtes HTTP
- **Règles de validation** : Définition de règles spécifiques pour chaque champ
- **Messages personnalisés** : Adaptation des messages d'erreur pour une meilleure expérience utilisateur

## Sécurisation

### Authentification et Autorisation

#### Système d'Authentification

- **Laravel Sanctum** : Gestion de l'authentification avec support des tokens API
- **Protection contre les attaques** : Limitation des tentatives de connexion, protection CSRF
- **Sessions sécurisées** : Cookies HTTP-only, expiration automatique

#### Gestion des Permissions

- **Système de rôles** : Administrateur, Ressourcerie, Client
- **Permissions de base** : Contrôle des accès aux fonctionnalités
- **Middleware d'autorisation** : Vérification des permissions à chaque requête

### Protection des Données

#### Sécurisation des Données Sensibles

- **Chiffrement des données** : Protection des informations sensibles
- **Hachage des mots de passe** : Utilisation de l'algorithme Bcrypt
- **Validation des entrées** : Contrôle des entrées utilisateur

#### Sécurité des Transactions

- **Protocole HTTPS** : Communication chiffrée entre client et serveur
- **Tokenisation des paiements** : Aucune donnée de carte bancaire stockée sur les serveurs
- **Journalisation des transactions** : Traçabilité des opérations financières

### Mesures de Sécurité Supplémentaires

#### Protection contre les Vulnérabilités Web

Le projet PIVOT Marketplace implémente plusieurs mesures pour se protéger contre les vulnérabilités web courantes :

1. **Protection contre les injections SQL**
   - Utilisation de l'ORM Eloquent qui utilise des requêtes préparées
   - Validation stricte des entrées utilisateur
   - Échappement automatique des données dans les requêtes

2. **Protection contre les attaques XSS (Cross-Site Scripting)**
   - Échappement automatique des sorties dans les vues React
   - Utilisation de la directive `@csrf` dans les formulaires
   - Validation et nettoyage des entrées utilisateur

3. **Protection contre les attaques CSRF (Cross-Site Request Forgery)**
   - Génération automatique de tokens CSRF pour chaque session
   - Validation des tokens pour toutes les requêtes POST, PUT, DELETE
   - Utilisation du middleware `VerifyCsrfToken` de Laravel

4. **En-têtes de sécurité HTTP**
   - Configuration des en-têtes de sécurité via le middleware
   - Utilisation de Content-Security-Policy pour limiter les sources de contenu
   - Configuration de X-Frame-Options pour prévenir le clickjacking

#### Journalisation et Surveillance

Le système de journalisation est configuré pour enregistrer les événements importants liés à la sécurité :

- **Journalisation des authentifications** : Enregistrement des tentatives de connexion réussies et échouées
- **Journalisation des actions sensibles** : Suivi des modifications de données critiques
- **Alertes de sécurité** : Configuration d'alertes pour les comportements suspects

## Méthodes de Testing

### Approche de Test

Le projet PIVOT Marketplace adopte une approche de test à plusieurs niveaux pour garantir la qualité et la fiabilité du code. La stratégie de test combine des tests automatisés et des tests manuels, avec un accent particulier sur les fonctionnalités critiques comme l'authentification, la gestion des produits et le processus de paiement.

### Tests Unitaires

Les tests unitaires sont implémentés à l'aide du framework de test PHPUnit intégré à Laravel. Ces tests se concentrent sur la vérification du comportement des composants individuels de l'application :

- **Tests de modèles** : Vérification des relations, des accesseurs/mutateurs et des méthodes personnalisées
- **Tests de services** : Validation de la logique métier encapsulée dans les services
- **Tests de validation** : Vérification des règles de validation des Form Requests

Exemple de test unitaire pour un modèle Product :

```php
public function test_product_belongs_to_ressourcerie()
{
    $product = Product::factory()->create();
    $this->assertInstanceOf(Ressourcerie::class, $product->ressourcerie);
}

public function test_product_has_valid_price()
{
    $product = Product::factory()->create(['price' => -10]);
    $this->assertFalse($product->isValid());
    
    $product->price = 100;
    $this->assertTrue($product->isValid());
}
```

### Tests Fonctionnels

Les tests fonctionnels vérifient le comportement de l'application dans son ensemble, en simulant les interactions utilisateur avec le système :

- **Tests de contrôleurs** : Vérification des réponses HTTP et du traitement des requêtes
- **Tests de formulaires** : Validation du traitement des données soumises
- **Tests d'intégration** : Vérification des interactions entre les différents composants

Exemple de test fonctionnel pour la création d'un produit :

```php
public function test_ressourcerie_can_create_product()
{
    $user = User::factory()->create(['role_id' => Role::where('name', 'ressourcerie')->first()->id]);
    $ressourcerie = Ressourcerie::factory()->create(['user_id' => $user->id]);
    
    $response = $this->actingAs($user)
        ->post('/products', [
            'name' => 'Test Product',
            'description' => 'Product description',
            'price' => 99.99,
            'category_id' => 1,
            'condition' => 'good',
            'dimensions' => '10x20x30',
            'color' => 'blue',
            'brand' => 'Test Brand'
        ]);
    
    $response->assertRedirect('/products');
    $this->assertDatabaseHas('products', ['name' => 'Test Product']);
}
```

## PV de Recette

### Scénarios de Test

Les scénarios de test suivants ont été définis pour valider les fonctionnalités principales de la plateforme PIVOT Marketplace :

#### Scénario 1 : Inscription et Connexion

1. **Inscription d'un nouvel utilisateur de type Client**
   - Accéder à la page d'inscription
   - Remplir le formulaire avec des informations valides
   - Sélectionner le type d'utilisateur "Client"
   - Soumettre le formulaire
   - Vérifier la redirection vers le tableau de bord client

2. **Inscription d'un nouvel utilisateur de type Ressourcerie**
   - Accéder à la page d'inscription
   - Remplir le formulaire avec des informations valides
   - Sélectionner le type d'utilisateur "Ressourcerie"
   - Soumettre le formulaire
   - Vérifier la redirection vers le tableau de bord ressourcerie

3. **Connexion d'un utilisateur existant**
   - Accéder à la page de connexion
   - Saisir les identifiants valides
   - Soumettre le formulaire
   - Vérifier la redirection vers le tableau de bord correspondant au type d'utilisateur

#### Scénario 2 : Gestion des Produits

1. **Ajout d'un nouveau produit par une ressourcerie**
   - Se connecter en tant que ressourcerie
   - Accéder à la section "Produits"
   - Cliquer sur "Ajouter un produit"
   - Remplir le formulaire avec des informations valides
   - Télécharger une image
   - Soumettre le formulaire
   - Vérifier l'apparition du produit dans la liste des produits

2. **Modification d'un produit existant**
   - Se connecter en tant que ressourcerie
   - Accéder à la section "Produits"
   - Sélectionner un produit existant
   - Modifier les informations
   - Soumettre le formulaire
   - Vérifier la mise à jour des informations

3. **Suppression d'un produit**
   - Se connecter en tant que ressourcerie
   - Accéder à la section "Produits"
   - Sélectionner un produit existant
   - Cliquer sur "Supprimer"
   - Confirmer la suppression
   - Vérifier la disparition du produit de la liste

#### Scénario 3 : Parcours d'Achat

1. **Recherche et filtrage des produits**
   - Accéder à la page d'accueil
   - Utiliser la barre de recherche
   - Appliquer des filtres par catégorie et prix
   - Vérifier la pertinence des résultats

2. **Ajout de produits au panier**
   - Sélectionner un produit
   - Cliquer sur "Ajouter au panier"
   - Vérifier la mise à jour du panier
   - Répéter l'opération pour plusieurs produits

3. **Processus de commande et paiement**
   - Accéder au panier
   - Vérifier le récapitulatif des produits
   - Procéder au paiement
   - Remplir les informations de livraison
   - Saisir les informations de paiement
   - Confirmer la commande
   - Vérifier la confirmation de commande

### Résultats des Tests

Les résultats des tests effectués sur la plateforme PIVOT Marketplace sont présentés ci-dessous :

#### Scénario 1 : Inscription et Connexion

| Test | Résultat | Commentaires |
|------|----------|-------------|
| Inscription Client | ✅ Succès | L'inscription fonctionne correctement, l'utilisateur est redirigé vers son tableau de bord. |
| Inscription Ressourcerie | ✅ Succès | L'inscription fonctionne correctement, l'utilisateur est redirigé vers son tableau de bord. |
| Connexion | ✅ Succès | La connexion fonctionne correctement pour les deux types d'utilisateurs. |

#### Scénario 2 : Gestion des Produits

| Test | Résultat | Commentaires |
|------|----------|-------------|
| Ajout de produit | ✅ Succès | L'ajout de produit fonctionne correctement, le produit apparaît dans la liste. |
| Modification de produit | ✅ Succès | La modification fonctionne correctement, les informations sont mises à jour. |
| Suppression de produit | ✅ Succès | La suppression fonctionne correctement, le produit disparaît de la liste. |

#### Scénario 3 : Parcours d'Achat

| Test | Résultat | Commentaires |
|------|----------|-------------|
| Recherche et filtrage | ✅ Succès | La recherche et les filtres fonctionnent correctement, les résultats sont pertinents. |
| Ajout au panier | ✅ Succès | L'ajout au panier fonctionne correctement, le panier est mis à jour. |
| Processus de commande | ✅ Succès | Le processus de commande fonctionne correctement, la commande est créée et confirmée. |

### Validation

Sur la base des résultats des tests, la plateforme PIVOT Marketplace est validée pour une utilisation en tant que proof of concept. Les fonctionnalités principales sont opérationnelles et répondent aux besoins identifiés.

Points forts identifiés :
- Interface utilisateur intuitive et responsive
- Processus d'inscription et de connexion fluide
- Gestion efficace des produits pour les ressourceries
- Parcours d'achat simplifié pour les clients

Points d'amélioration pour les versions futures :
- Optimisation des performances pour les listes de produits volumineuses
- Enrichissement des fonctionnalités de recherche et de filtrage
- Amélioration de la gestion des stocks
- Développement des fonctionnalités de reporting et d'analyse

## Prototype

### Description

Le prototype est une représentation simplifiée de la plateforme Pivot pour ressourceries, conçue pour tester les fonctionnalités principales et valider les concepts avant de les développer davantage.

### Fonctionnalités Testées

- **Authentification** : Test de l'inscription, de la connexion et de la gestion des profils.
- **Gestion des produits** : Ajout, modification et suppression de produits.
- **Gestion des commandes** : Création, suivi et gestion des commandes.
- **Gestion des paiements** : Intégration avec Stripe pour les transactions sécurisées.

### Technologies Utilisées

- **React** : Pour le frontend.
- **Laravel** : Pour le backend.
- **Stripe** : Pour les paiements.
- **Tailwind CSS** : Pour le style.
- **Inertia.js** : Pour la navigation sans rechargement de page.

### Résultats

Les tests réalisés lors de la phase de prototype ont permis de valider les concepts de base et d'identifier les points d'amélioration pour les futures versions.

## Conclusion

### Synthèse du Projet PIVOT Marketplace

Ce dossier technique présente le proof of concept de PIVOT Marketplace, une plateforme dédiée aux ressourceries en France. Ce projet répond à un besoin concret du secteur de l'économie circulaire, en offrant aux structures de réemploi un outil numérique adapté à leurs spécificités.

L'analyse du contexte a permis d'identifier les défis uniques auxquels font face les ressourceries : gestion de produits de seconde main souvent uniques, besoin de visibilité, et nécessité d'une solution technique accessible à des structures aux ressources limitées. Ces défis ont guidé les choix techniques et fonctionnels du projet.

### Points Forts du Projet

#### Solution Technique Adaptée

PIVOT Marketplace utilise des technologies modernes (Laravel, Inertia.js, React) avec une architecture simple mais efficace. Cette combinaison permet d'offrir une expérience utilisateur fonctionnelle, tout en garantissant la sécurité et la maintenabilité de la plateforme.

L'intégration de fonctionnalités spécifiques au contexte des ressourceries, comme la gestion de produits uniques, démontre la capacité du projet à répondre aux besoins du secteur.

#### Approche Centrée Utilisateur

La conception de PIVOT Marketplace a été guidée par une compréhension des besoins des deux publics cibles : les ressourceries et leurs clients. Cette approche se traduit par des interfaces fonctionnelles et des parcours d'utilisation simplifiés.

#### Impact Social et Environnemental

Au-delà de ses qualités techniques, PIVOT Marketplace contribue à la transition écologique et à l'économie sociale et solidaire. En facilitant l'accès aux produits de seconde main, la plateforme favorise la réduction des déchets, l'allongement de la durée de vie des objets et la sensibilisation du public aux enjeux de la consommation responsable.

### Perspectives d'Évolution

Le développement de PIVOT Marketplace s'inscrit dans une vision à long terme, avec plusieurs axes d'évolution identifiés :

1. **Élargissement du réseau** : Intégration progressive de nouvelles ressourceries sur le territoire français.

2. **Enrichissement fonctionnel** : Développement de nouvelles fonctionnalités basées sur les retours d'usage, comme un système de réservation, des outils de gestion de stock plus sophistiqués, ou des fonctionnalités communautaires.

3. **Interopérabilité** : Création d'API permettant l'intégration avec d'autres outils utilisés par les ressourceries.

4. **Analyse de données** : Exploitation des données anonymisées pour mesurer l'impact global du réemploi.

### Mot de la Fin

Ce proof of concept de PIVOT Marketplace représente une première étape vers une solution complète pour les ressourceries. En offrant aux ressourceries un outil numérique adapté à leurs besoins fondamentaux, la plateforme leur permet de développer leur activité et d'élargir leur clientèle.

La qualité technique du projet, sa pertinence fonctionnelle et son potentiel d'évolution en font une base solide pour le développement futur d'une solution plus complète, capable d'accompagner le développement du secteur des ressourceries dans les années à venir.

PIVOT Marketplace démontre ainsi que le numérique peut être un levier de transformation écologique lorsqu'il est mis au service de l'économie circulaire et solidaire. 